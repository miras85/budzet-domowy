export default {
    props: ['newTx', 'accounts', 'activeLoans', 'filteredCategories', 'categorySearch', 'editingTxId', 'isPlanned'],
    emits: ['update:isPlanned', 'update:categorySearch', 'submit-transaction', 'cancel-edit', 'detect-category', 'handle-loan-change'],
    data() { return { showCategorySelector: false } },
    template: `
    <div class="px-4 pt-4 pb-40">
        <h2 class="text-lg font-bold text-white mb-4 text-center">{{ editingTxId ? 'Edycja' : 'Nowa transakcja' }}</h2>
        <div class="bg-slate-800 p-1 rounded-xl flex mb-6"><button @click="newTx.type = 'expense'" class="type-btn flex-1" :class="newTx.type === 'expense' ? 'active-exp' : 'inactive-btn'">Wydatek</button><button @click="newTx.type = 'income'" class="type-btn flex-1" :class="newTx.type === 'income' ? 'active-inc' : 'inactive-btn'">Przychód</button><button @click="newTx.type = 'transfer'" class="type-btn flex-1" :class="newTx.type === 'transfer' ? 'active-trf' : 'inactive-btn'">Transfer</button></div>
        <div class="mb-8 relative text-center"><input v-model="newTx.amount" type="number" step="0.01" inputmode="decimal" pattern="[0-9]*" class="big-amount-input" placeholder="0.00"><div class="text-slate-500 text-sm font-bold mt-1">PLN</div></div>
        <div class="space-y-2">
            <div class="grid grid-cols-2 gap-2"><div class="bg-slate-800 p-3 rounded-xl border border-slate-700"><label class="text-[10px] text-slate-400 uppercase font-bold block mb-1">Kiedy?</label><input v-model="newTx.date" type="date"></div><div class="bg-slate-800 p-3 rounded-xl border border-slate-700 relative"><label class="text-[10px] text-slate-400 uppercase font-bold block mb-1">{{ newTx.type === 'income' ? 'Na konto' : 'Z konta' }}</label><select v-model="newTx.account_id" class="bg-transparent text-white text-sm font-bold w-full outline-none appearance-none pr-4 truncate"><option v-for="acc in accounts" :value="acc.id">{{ acc.name }}</option></select><div class="absolute right-3 bottom-3 pointer-events-none text-slate-400 text-xs">▼</div></div></div>
            <div class="bg-slate-800 p-3 rounded-xl border border-slate-700"><input v-model="newTx.description" 
                @input="$emit('detect-category')" type="text" class="bg-transparent text-white text-sm w-full outline-none" placeholder="Opis (wymagane)"></div>
            <div v-if="newTx.type === 'transfer'" class="bg-slate-800 p-3 rounded-xl border border-slate-700 relative"><label class="text-[10px] text-slate-400 uppercase font-bold block mb-1">Na konto</label><select v-model="newTx.target_account_id" class="bg-transparent text-white text-sm font-bold w-full outline-none appearance-none pr-4 truncate"><option v-for="acc in accounts" :value="acc.id" :disabled="acc.id === newTx.account_id">{{ acc.name }}</option></select><div class="absolute right-3 bottom-3 pointer-events-none text-slate-400 text-xs">▼</div></div>
            <div v-if="newTx.type !== 'transfer'" class="mt-4">
                <label class="text-[10px] text-slate-400 uppercase font-bold block mb-2">Kategoria</label>
                <div v-if="newTx.type === 'expense'" class="bg-slate-800 p-3 rounded-xl border border-slate-700 mb-3 flex justify-between items-center"><span class="text-sm text-blue-400 font-bold">Spłata kredytu?</span><select v-model="newTx.loan_id" @change="$emit('handle-loan-change')" class="bg-transparent text-sm text-white font-bold outline-none appearance-none text-right pr-4"><option :value="null">Nie</option><option v-for="loan in activeLoans" :value="loan.id">{{ loan.name }}</option></select></div>
                <div v-if="!newTx.loan_id"><div @click="showCategorySelector = !showCategorySelector" class="bg-slate-800 p-3 rounded-xl border border-slate-700 flex justify-between items-center cursor-pointer active:bg-slate-700 transition-colors"><span :class="newTx.category_name ? 'text-white font-bold' : 'text-slate-500'">{{ newTx.category_name || 'Wybierz kategorię...' }}</span><span class="text-slate-400 text-xs">▼</span></div><div v-if="showCategorySelector" class="mt-3 bg-slate-800 p-3 rounded-xl border border-slate-700 animate-fade-in"><input :value="categorySearch" @input="$emit('update:categorySearch', $event.target.value)" placeholder="Szukaj..." class="w-full bg-slate-900 p-2 rounded-lg text-sm text-white mb-3 border border-slate-700 outline-none focus:border-blue-500"><div class="grid grid-cols-3 gap-2 max-h-48 overflow-y-auto"><button v-for="cat in filteredCategories" :key="cat.id" @click="newTx.category_name = cat.name; showCategorySelector = false" class="cat-chip" :class="newTx.category_name === cat.name ? 'selected' : ''">{{ cat.name }}</button></div></div></div>
            </div>
            <label class="flex items-center justify-center gap-2 text-xs text-slate-400 py-4"><input type="checkbox" :checked="isPlanned" @change="$emit('update:isPlanned', $event.target.checked)" class="w-4 h-4 rounded bg-slate-700 border-slate-500"> Zaznacz jako transakcję planowaną</label>
            <div class="flex gap-3 pt-2"><button v-if="editingTxId" @click="$emit('cancel-edit')" class="flex-1 py-3 rounded-xl font-bold text-slate-400 bg-slate-800 text-sm">Anuluj</button><button @click="$emit('submit-transaction')" class="flex-[2] py-3 rounded-xl font-bold text-white bg-blue-600 shadow-lg shadow-blue-600/30 text-sm active:scale-95 transition-transform">{{ editingTxId ? 'Zapisz zmiany' : 'Dodaj transakcję' }}</button></div>
        </div>
    </div>`
}
